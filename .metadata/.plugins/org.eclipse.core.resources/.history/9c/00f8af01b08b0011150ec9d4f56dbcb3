package com.webwoz.client.server;

import java.sql.*;

public class Database {
	
	// Database access
	private Connection conn;
	private String url = "jdbc:mysql://localhost:3306/webwoz?allowMultiQueries=true&autoReconnect=true";
	private String user = "testuser";
	private String pass = "testuser";
	
	public Database() {
		MySQLConnection();
	}

	public void MySQLConnection() {

		try {
			Class.forName("com.mysql.jdbc.Driver").newInstance();
			conn = DriverManager.getConnection(url, user, pass);

		} catch (Exception e) {
			System.out.println(e);
		}
	}

	// retrieveData
	public String[][] retrieveData(String sql) {

		try {
			Statement stmt = conn.createStatement();

			ResultSet rs = stmt.executeQuery(sql);
			// get rs meta data
			ResultSetMetaData meta = rs.getMetaData();
			// get column count
			int cCount = meta.getColumnCount();

			// get result count in order to define the size of the array
			int current = rs.getRow();
			rs.last();
			int count = rs.getRow();
			if (count != 0) {
				// count = 0;
				if (current == 0) {
					rs.beforeFirst();
				} else {
					rs.absolute(current);
				}

				String[][] s = new String[count][cCount];
				int i = 0;

				while (rs.next()) {
					for (int j = 0; j < cCount; j++) {
						s[i][j] = rs.getString(j + 1);
					}
					i++;
				}
				rs.close();
				return s;
			} else {
				return null;
			}

		} catch (Exception sqle) {
			System.out.println(sqle);
			return null;

		} finally {
			
		}
	}
	
	// storeData
	public void storeData(String sql) {

		try {
			Statement stmt = conn.createStatement();
			stmt.executeUpdate(sql);

		} catch (Exception sqle) {
			System.out.println(sqle);

		} finally {

		}

	}

	// close database connection
	public void closeDBCon() {
		try {
			conn.close();
		} catch (Exception dbe) {
			System.out.println(dbe);
		}

	}

}

